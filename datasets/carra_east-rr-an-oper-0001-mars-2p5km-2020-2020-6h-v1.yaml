# Link for checking the available fields:
# https://apps.ecmwf.int/mars-catalogue/?origin=no-ar-ce&stream=oper&expver=prod&month=jan&year=1993&type=an&class=rr
# Documentation: https://climate.copernicus.eu/copernicus-arctic-regional-reanalysis-service

description: |
  Copernicus Arctic Regional Reanalysis, East domain.

# name: carra_east-rr-an-oper-0001-mars-2p5km-1989-2023-6h-v1
name: carra_east-rr-an-oper-0001-mars-2p5km-2020-2020-6h-v1

dates:
  # start: 1990-09-01T00:00:00
  # end: 2023-12-31T18:00:00
  start: 2020-01-01T00:00:00
  end: 2020-12-31T18:00:00
  frequency: 6h

build:
  group_by: daily

input:
  join:
  - pipe:
    - mars:
        origin: no-ar-ce
        levtype: pl
        class: rr
        type: an
        stream: oper
        # 260238 is geometric vertical velocity
        param: [r, t, u, v, z, 260238]
        level: [50, 100, 150, 200, 250, 300, 400, 500, 600, 700, 850, 925, 1000]
    - pressure_level_relative_humidity_to_specific_humidity:
        t: t
        rh: r
    - wz_to_w:
        wz: wz
        t: t
  - pipe:
    - mars:
        origin: no-ar-ce
        levtype: sfc
        class: rr
        type: an
        stream: oper
        # tciwv, tciw, tclw, tcolg are 78, 79, 260001, 260057
        param: [sp, msl, 10u, 10v, 2t, lsm, sp, skt, 78, 79, 260001, 260057, orog, 2r]
    - orog_to_z:
        orog: orog
    - single_level_relative_humidity_to_dewpoint:
        t: 2t
        rh: 2r
        td: 2d
    - sum:
        params: [tciwv, tciw, tclw, tcolg]
        output: tcw
  # Doesn't work, since to get 6h precip for 12Z and 00Z, we need to sum the 3h precip from 06Z and 09Z runs
  #- accumulations:
  #    origin: no-ar-ce
  #    levtype: sfc
  #    class: rr
  #    type: an
  #    stream: oper
  #    param: [tp]

  - constants:
      template: ${input.join.0.pipe.0.mars}
      param:
      - cos_latitude
      - cos_longitude
      - sin_latitude
      - sin_longitude
      - cos_julian_day
      - cos_local_time
      - sin_julian_day
      - sin_local_time
      - insolation
